.row
  %h2 Create a New Project
.row
  = simple_form_for @project, url: projects_path do |f|
    .col-lg-8

      .form-group
        - if f.error_notification.present?
          .alert.alert-warning
            = f.error_notification
        %label{for: 'project_name'} Project Title
        .input-group
          = f.text_field :name, required: true, class: 'form-control'
          %span.input-group-addon
            %span#name_icon.glyphicon.glyphicon-asterisk
        .error-text#name_error.hidden
          Please enter a name
      .form-group
        %label{for: 'project_description'} Description
        .input-group
          = f.text_area :description, required: true, class: 'form-control', rows: 5, placeholder: "Why should people choose to fund you?"
          %span.input-group-addon
            %span#description_icon.glyphicon.glyphicon-asterisk
        .error-text#description_error.hidden
          Please enter a description
      .form-group
        %label{for: 'target_amount'} Target Amount
        .input-group
          = f.text_field :target_amount, requied: true, class: 'form-control', placeholder: "$ CAD, $100 minimum"
          %span.input-group-addon
            %span#target_amount_icon.fa.fa-money
        .error-text#target_amount_error.hidden
          Please enter an amount greater than $100
      .form-group
        %label{for: 'project_completion_date'} Completion Date
        .form-inline
          = f.input :completion_date, as: :date, required: true, class: 'form-control', start_year: Project.minimum_start_year, end_year: Project.maximum_end_year, order: [:day, :month, :year], label: false
          %span.input-group-addon.hidden

      #communities
        .form-group
          .panel.panel-primary
            .panel-heading Which Communities is your project involved with?
            .panel-body
              %ul.list-group
                - @communities.each do |community|
                  .checkbox
                    %label
                      = check_box_tag "community_#{community.id}", true, class: 'form-control'
                      = community.name

      #rewards
        .form-group
          .panel.panel-primary
            .panel-heading Reward Levels
            .panel-body
              %ul.list-group
                = f.simple_fields_for :rewards do |reward|
                  = render 'reward_fields', f: reward
                .links
                  = link_to_add_association 'Add Reward Level', f, :rewards

      -# TODO banner

      = f.button :submit, "Submit", id: 'submit_button', class: 'btn btn-info pull-right' 

:coffeescript
  $ ->
    $("select").addClass('form-control')
    $('.checkbox').find('input').attr('checked', false)
    $('#submit_button')[0].disabled = true

  $('#project_name').bind 'input', ->
    empty_content_validator(check_valid_content($(this)), $(this), '#name_icon', '#name_error')
    
  $('#project_description').bind 'input', ->
    empty_content_validator(check_valid_content($(this)), $(this), '#description_icon', '#description_error')

  $('#project_target_amount').bind 'input', ->
    money_validator(check_valid_amount($(this)), $(this), '#target_amount_icon', '#target_amount_error')

  $('#project_completion_date_3i, #project_completion_date_2i, #project_completion_date_1i').change ->
    valid_date()

  check_valid_content = (ref) ->
    if ref.val() == ""
      return false
    else
      return true

  check_valid_amount = (ref) ->
    num = parseInt(ref.val())
    if (num >= 100) && (num != NaN)
      return true
    else
      return false

  valid_date =->
    day = $('#project_completion_date_3i').val()
    month = $('#project_completion_date_2i').val()
    year = $('#project_completion_date_1i').val()

    # TODO:
    #   finish validating date
    #   validate at least one community is chosen
    #   validate at least one reward has been created

  empty_content_validator = (value, ref, icon, error_text) ->
    if value
      ref.removeClass('has-error')
      $(error_text).removeClass('hidden')
      field_span = ref.parent().find(icon)
      field_span.removeClass("glyphicon glyphicon-asterisk fa fa-exclamation-circle")
      field_span.addClass("fa fa-check")
    else
      ref.addClass('has-error')
      $(error_text).addClass('hidden')
      field_span = ref.parent().find(icon)
      field_span.removeClass("glyphicon glyphicon-asterisk fa fa-check")
      field_span.addClass("fa fa-exclamation-circle")

  money_validator = (value, ref, icon, error_text) ->
    if value
      ref.removeClass('has-error')
      $(error_text).addClass('hidden')
      field_span = ref.parent().find(icon)
      field_span.removeClass("has-money-error")
      field_span.addClass("correct-money")
    else
      ref.addClass('has-error')
      $(error_text).removeClass('hidden')
      field_span = ref.parent().find(icon)
      field_span.removeClass("correct-money")
      field_span.addClass("has-money-error")


